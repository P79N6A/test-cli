<i18n>
    {
        "zh-cn": {
            "新股认购":"新股认购",
            "认购记录":"认购记录",
            "0手续费认购活动说明：手续费以先收后返的方式减免。xx港币手续费将在认购截止日扣款后的7个工作日内返还至您的证券账户。":"0手续费认购活动说明：手续费以先收后返的方式减免。{money}港币手续费将在认购截止日扣款后的7个工作日内返还至您的证券账户。",
            "0本金认购活动说明：认购费用以先收后返的方式减免。xx港币手续费和融资利息将在认购截止日扣款后的7个工作日内返还至您的证券账户。":"0本金认购活动说明：认购费用以先收后返的方式减免。{money}港币手续费和融资利息将在认购截止日扣款后的7个工作日内返还至您的证券账户。",
            "查看活动详情":"查看活动详情",
            "认购方式":"认购方式",
            "所选方式":"所选方式",
            "现金认购":"现金认购",
            "富途融资认购":"富途融资认购",
            "银行融资认购":"银行融资认购",
            "0本金认购":"0本金认购",
            "认购账户":"认购账户",
            "认购明细":"认购明细",
            "认购新股":"认购新股",
            "认购股数":"认购股数",
            "xx股":"{num} 股",
            "使用可提金额":"使用可提金额",
            "使用现金":"使用现金",
            "xx港币":"{money} 港币",
            "港币":"港币",
            "使用富途融资":"使用富途融资",
            "（年利率xx%）":"（年利率 {num} %）",
            "使用银行融资":"使用银行融资",
            "银行融资利息（中签日当天扣除）":"银行融资利息（中签日当天扣除）",
            "1. 使用银行融资=认购金额-使用账户资金2. 银行融资利息=使用银行融资金额 * 计息日 * 日利率3. 预计计息日为xx天，计息时长为富途截止认购后一自然日到公布中签前一自然日": "1. 使用银行融资=认购金额-使用账户资金<br>2. 银行融资利息=使用银行融资金额 * 计息日 * 日利率<br>3. 预计计息日为{day}天，计息时长为富途截止认购后一自然日到公布中签前一自然日 <a href=\"//{helpFutu5}/faq/topic2294\">查看详情</a>",
            "手续费":"手续费",
            "（先收后返）":"（先收后返）",
            "（代银行收取）":"（代银行收取）",
            "无论认购是否中签，均需缴纳。因参与活动获免的手续费金额请以活动详细说明为准":"无论认购是否中签，均需缴纳。因参与活动获免的手续费金额请以活动详细说明为准",
            "使用富途融资产生的利息随融资账户月结，随借随还，不计入新股认购费用之中。最终扣费请以结单为准。":"使用富途融资产生的利息随融资账户月结，随借随还，不计入新股认购费用之中。最终扣费请以结单为准。",
            "我已阅读并同意":"我已阅读并同意",
            "《富途证券新股认购声明》":"《富途证券新股认购声明》",
            "合计：":"合计：",
            "确认修改":"确认修改",
            "立即认购":"立即认购",
            "提示":"提示",
            "取消":"取消",
            "确定":"确定",
            "查看":"查看",
            "您已申请认购该支股票，查看任务详情":"您已申请认购该支股票，查看任务详情",
            "去设置":"去设置",
            "0本金认购中xx港币将使用富途融资（利率xx%）":"0本金认购中{money}港币将使用富途融资（利率{num}%）",
            "0本金认购中xx港币将使用银行融资（利率xx%）。请注意，0本金认购不支持修改，您可撤销后重新提交认购申请。":"0本金认购中{money}港币将使用银行融资（利率{num}%）。请注意，0本金认购不支持修改，您可撤销后重新提交认购申请。",
            "0本金认购中xx港币将使用富途融资（利率xx%），xx港币将使用银行融资（利率xx%）。请注意，0本金认购不支持修改，您可撤销后重新提交认购申请。":"0本金认购中{futuMoney}港币将使用富途融资（利率{futuNum}%），{money}港币将使用银行融资（利率{num}%）。请注意，0本金认购不支持修改，您可撤销后重新提交认购申请。",
            "认购金额超过使用的可提金额，其中xx港币将使用富途融资（利率xx%）":"认购金额超过使用的可提金额，其中{money}港币将使用富途融资（利率{num}%）",
            "认购金额超过使用的可提金额，其中xx港币将使用银行融资（利率xx%）。请注意，银行融资认购不可撤销，若认购期间账户风险状态处于“危险”狀态，富途将保留強平权利，请注意风险。":"认购金额超过使用的可提金额，其中{money}港币将使用银行融资（利率{num}%）。请注意，银行融资认购不可撤销，若认购期间账户风险状态处于“危险”狀态，富途将保留強平权利，请注意风险。",
            "认购金额超过使用的可提金额，其中xx港币将使用富途融资（利率xx%），xx港币将使用银行融资（利率xx%）。请注意，银行融资认购不可撤销，若认购期间账户风险状态处于“危险”狀态，富途将保留強平权利，请注意风险。":"认购金额超过使用的可提金额，其中{futuMoney}港币将使用富途融资（利率{futuNum}%），{money}港币将使用银行融资（利率{num}%）。请注意，银行融资认购不可撤销，若认购期间账户风险状态处于“危险”狀态，富途将保留強平权利，请注意风险。"
        },
        "zh-hk": {
            "新股认购":"新股認購",
            "认购记录":"認購記錄",
            "0手续费认购活动说明：手续费以先收后返的方式减免。xx港币手续费将在认购截止日扣款后的7个工作日内返还至您的证券账户。":"0手續費認購活動說明：手續費以先收後返的方式減免。{money}港幣手續費將在認購截止日扣款後的7個工作日內返還至您的證券帳戶。",
            "0本金认购活动说明：认购费用以先收后返的方式减免。xx港币手续费和融资利息将在认购截止日扣款后的7个工作日内返还至您的证券账户。":"0本金認購活動說明：認購費用以先收後返的方式減免。{money}港幣手續費和孖展利息將在認購截止日扣款後的7個工作日內返還至您的證券帳戶。",
            "查看活动详情":"查看活動詳情",
            "认购方式":"認購方式",
            "所选方式":"所選方式",
            "现金认购":"現金認購",
            "富途融资认购":"富途孖展認購",
            "银行融资认购":"银行孖展認購",
            "0本金认购":"0本金認購",
            "认购账户":"認購帳戶",
            "认购明细":"認購明細",
            "认购新股":"認購新股",
            "认购股数":"認購股數",
            "xx股":"{num} 股",
            "使用可提金额":"使用可提金額",
            "使用现金":"使用現金",
            "xx港币":"{money} 港幣",
            "港币":"港幣",
            "使用富途融资":"使用富途孖展",
            "（年利率xx%）":"（年利率 {num} %）",
            "使用银行融资":"使用銀行孖展",
            "银行融资利息（中签日当天扣除）":"銀行孖展利息（中籤日當天扣除）",
            "1. 使用银行融资=认购金额-使用账户资金2. 银行融资利息=使用银行融资金额 * 计息日 * 日利率3. 预计计息日为xx天，计息时长为富途截止认购后一自然日到公布中签前一自然日": "1. 使用銀行孖展=認購金額-使用帳戶資金<br>2. 銀行孖展利息=使用銀行孖展金額* 計息日* 日利率<br>3. 預計計息日為{day}天，計息時長為富途截止認購後一自然日到公佈中籤前一自然日<a href=\"//{helpFutu5}/faq/topic2294\">查看詳情</ a>",
            "手续费":"手續費",
            "（先收后返）":"（先收後返）",
            "（代银行收取）":"（代銀行收取）",
            "无论认购是否中签，均需缴纳。因参与活动获免的手续费金额请以活动详细说明为准":"無論認購是否中籤，均需繳納。因參與活動獲免的手續費金額請以活動詳細說明為準",
            "使用富途融资产生的利息随融资账户月结，随借随还，不计入新股认购费用之中。最终扣费请以结单为准。":"使用富途孖展產生的利息隨孖展帳戶月結，隨借隨還，不計入新股認購費用之中。最終扣費請以結單為準。",
            "我已阅读并同意":"我已閱讀並同意",
            "《富途证券新股认购声明》":"《富途證券新股認購聲明》",
            "合计：":"合計：",
            "确认修改":"確認修改",
            "立即认购":"立即認購",
            "提示":"提示",
            "取消":"取消",
            "确定":"確定",
            "查看":"查看",
            "您已申请认购该支股票，查看任务详情":"您已申請認購該支股票，查看任務詳情",
            "去设置":"去設置",
            "0本金认购中xx港币将使用富途融资（利率xx%）":"0本金認購中{money}港幣將使用富途孖展（利率{num}%）",
            "0本金认购中xx港币将使用银行融资（利率xx%）。请注意，0本金认购不支持修改，您可撤销后重新提交认购申请。":"0本金認購中{money}港幣將使用銀行孖展（利率{num}%）。請注意，0本金認購不支持修改，您可撤銷後重新提交認購申請。",
            "0本金认购中xx港币将使用富途融资（利率xx%），xx港币将使用银行融资（利率xx%）。请注意，0本金认购不支持修改，您可撤销后重新提交认购申请。":"0本金認購中{futuMoney}港幣將使用富途孖展（利率{futuNum}%），{money}港幣將使用銀行孖展（利率{num}%）。請注意，0本金認購不支持修改，您可撤銷後重新提交認購申請。",
            "认购金额超过使用的可提金额，其中xx港币将使用富途融资（利率xx%）":"認購金額超過使用的可提金額，其中{money}港幣將使用富途孖展（利率{num} %)",
            "认购金额超过使用的可提金额，其中xx港币将使用银行融资（利率xx%）。请注意，银行融资认购不可撤销，若认购期间账户风险状态处于“危险”狀态，富途将保留強平权利，请注意风险。":"認購金額超過使用的可提金額，其中{money}港幣將使用銀行孖展（利率{num}%）。請注意，銀行孖展認購不可撤銷，若認購期間帳戶風險狀態處於“危險”狀態，富途將保留強平權利，請注意風險。",
            "认购金额超过使用的可提金额，其中xx港币将使用富途融资（利率xx%），xx港币将使用银行融资（利率xx%）。请注意，银行融资认购不可撤销，若认购期间账户风险状态处于“危险”狀态，富途将保留強平权利，请注意风险。":"認購金額超過使用的可提金額，其中{futuMoney}港幣將使用富途孖展（利率{futuNum}%）， {money}港幣將使用銀行孖展（利率{num}%）。請注意，銀行孖展認購不可撤銷，若認購期間帳戶風險狀態處於“危險”狀態，富途將保留強平權利，請注意風險。"
        },
        "en-us": {
            "新股认购":"IPO Subscription",
            "认购记录":"Subscription Record",
            "0手续费认购活动说明：手续费以先收后返的方式减免。xx港币手续费将在认购截止日扣款后的7个工作日内返还至您的证券账户。":"Event Description:The subscription fee will be refunded to your securities account within 7 working days after the deduction on the subscription deadline.",
            "0本金认购活动说明：认购费用以先收后返的方式减免。xx港币手续费和融资利息将在认购截止日扣款后的7个工作日内返还至您的证券账户。":"Zero asset Ordering Activity Description:The subscription fee is paid first and returned within 7 working days.The ${money} HKD handling fee and financing interest will be refunded to your securities account within 7 working days after the subscription deadline.",
            "查看活动详情":"View event details",
            "认购方式":"Subscription Type",
            "所选方式":"Subscription Type",
            "现金认购":"Cash Subscription",
            "富途融资认购":"Futu Financing",
            "银行融资认购":"IPO Financing",
            "0本金认购":"Zero Asset Subscription",
            "认购账户":"Subscription Account",
            "认购明细":"Subscription Details",
            "认购新股":"Stock Name",
            "认购股数":"Number of Shares",
            "xx股":"{num} shares",
            "使用可提金额":"Amount Available",
            "使用现金":"Cash Available",
            "xx港币":"{money} HKD",
            "港币":"HKD",
            "使用富途融资":"Futu Financing",
            "（年利率xx%）":"(Annual interest rate {num} %)",
            "使用银行融资":"Bank Financing",
            "银行融资利息（中签日当天扣除）":"Bank Financing Interest (deducted on the day of the allotment)",
            "1. 使用银行融资=认购金额-使用账户资金2. 银行融资利息=使用银行融资金额 * 计息日 * 日利率3. 预计计息日为xx天，计息时长为富途截止认购后一自然日到公布中签前一自然日": "1.Use bank financing=Subscription amount - use account funds.<br>2.Bank financing interest rate = use of bank financing amount * interest days * daily interest rate.<br>3.The estimated number of days to calculate interest is {day} days, specifically: the first natural day after the subscription is completed and the natural day before the announcement. <a href=\"//{helpFutu5}/faq/topic2294\">View details</a>",
            "手续费":"Fee",
            "（先收后返）":"(first and then return)",
            "（代银行收取）":"(charged on behalf of the bank)",
            "无论认购是否中签，均需缴纳。因参与活动获免的手续费金额请以活动详细说明为准":"Whether or not your subscription win none, partial, or all of the bid in an IPO, handling fee in connection with the IPO Shares subscription will not be refunded.",
            "使用富途融资产生的利息随融资账户月结，随借随还，不计入新股认购费用之中。最终扣费请以结单为准。":"Interest generated using Futu Financing is settled on a monthly basis and is not included in the subscription fee for new shares. The final deduction is subject to the monthly statement.",
            "我已阅读并同意":"I have read and agree to ",
            "《富途证券新股认购声明》":"Futu Securities IPO Subscription Statement",
            "合计：":"Total amount: ",
            "确认修改":"Confirm the change",
            "立即认购":"Confirm subscription",
            "提示":"Tips",
            "取消":"Cancel",
            "确定":"Confirm",
            "查看":"View",
            "您已申请认购该支股票，查看任务详情":"You have applied for the stock to view the mission details",
            "去设置":"Go to set",
            "0本金认购中xx港币将使用富途融资（利率xx%）":"During the zero asset subscription ${money} HKD will be used for Futu financing (interest rate {num}%)",
            "0本金认购中xx港币将使用银行融资（利率xx%）。请注意，0本金认购不支持修改，您可撤销后重新提交认购申请。":"During the zero asset subscription ${money} HKD will be used for Bank financing (interest rate {num}%). Please note that zero asset Subscription does not support modification, you can cancel and resubmit the subscription.",
            "0本金认购中xx港币将使用富途融资（利率xx%），xx港币将使用银行融资（利率xx%）。请注意，0本金认购不支持修改，您可撤销后重新提交认购申请。":"During the zero asset subscription ${futuMoney} HKD will be used for Futu financing (interest rate {futuNum}%), HKD will be used for Bank financing (interest rate {num}%). Please note that zero asset Subscription does not support modification, you can cancel and resubmit the subscription.",
            "认购金额超过使用的可提金额，其中xx港币将使用富途融资（利率xx%）":"The subscription amount exceeds the usable amount used, of which ${money} HKD will be used for Futu financing (interest rate {num}%)",
            "认购金额超过使用的可提金额，其中xx港币将使用银行融资（利率xx%）。请注意，银行融资认购不可撤销，若认购期间账户风险状态处于“危险”狀态，富途将保留強平权利，请注意风险。":"The subscription amount exceeds the usable amount used, of which ${money} HKD will be used for Bank financing (interest rate {num}%). Please note that bank financing subscriptions are irrevocable. If the account risk status is \"dangerous\" during the subscription period, Futu will reserve the right to force the liquidation.Please pay attention to the risks.",
            "认购金额超过使用的可提金额，其中xx港币将使用富途融资（利率xx%），xx港币将使用银行融资（利率xx%）。请注意，银行融资认购不可撤销，若认购期间账户风险状态处于“危险”狀态，富途将保留強平权利，请注意风险。":"The subscription amount exceeds the usable amount used, of which ${futuMoney}HKD will be used for Futu financing (interest rate {futuNum}%), ${money} HKD will be used for Bank financing (interest rate {num}%). Please note that bank financing subscriptions are irrevocable. If the account risk status is \"dangerous\" during the subscription period, Futu will reserve the right to force the liquidation.Please pay attention to the risks."
        }
    }
</i18n>
<template>
    <div class="wrapper ipo-apply-information-wrapper">
        <p class="ui-title pc-title-wrapper"><span class="ui-title-font">{{$t('新股认购')}}</span><span class="ui-title-link"><a href="/history">{{$t('认购记录')}}</a></span></p>
        <div class="wrapper apply-information-container">
            <div class="ui-alert" v-if="!applyInfo.marginPart && !applyInfo.zeroAsset">
                <i class="ui-badge ui-icon icon-sound"></i><span class="ui-alert-info">{{$t('0手续费认购活动说明：手续费以先收后返的方式减免。xx港币手续费将在认购截止日扣款后的7个工作日内返还至您的证券账户。' , {money: formatNumber(applyInfo.fee / 1000, 2)})}}<a :href="'//' + domain.actFutunn + '/hit-new'" target="_blank">{{$t('查看活动详情')}}</a></span>
            </div>
            <div class="ui-alert" v-if="applyInfo.zeroAsset">
                <i class="ui-badge ui-icon icon-sound"></i><span class="ui-alert-info">{{$t('0本金认购活动说明：认购费用以先收后返的方式减免。xx港币手续费和融资利息将在认购截止日扣款后的7个工作日内返还至您的证券账户。' , {money:formatNumber(applyInfo.fee / 1000, 2)})}}<a :href="'//' + domain.futunn + '/act/detail?id=1074'" target="_blank">{{$t('查看活动详情')}}</a></span>
            </div>
            <div class="wrapper ipo-information-container mgtop0">
                <div class="container info-container bdtop0">
                    <div class="title-container">
                        <h4 class="title">{{$t('认购方式')}}</h4>
                    </div>
                    <div class="information-container">
                        <div class="wrapper information-i">
                            <span class="lab">{{$t('所选方式')}}</span>
                            <span class="txt-box">
                                <span class="txt" v-if="applyInfo.zeroAsset">{{$t('0本金认购')}}</span>
                                <span class="txt" v-else-if="applyInfo.marginPart > 0">{{$t('银行融资认购')}}</span>
                                <span class="txt" v-else-if="applyInfo.assetMargin > 0">{{$t('富途融资认购')}}</span>
                                <span class="txt" v-else>{{$t('现金认购')}}</span>
                            </span>
                        </div>
                        <div class="wrapper information-i">
                            <span class="lab">{{$t('认购账户')}}</span><span class="txt-box"><span class="txt">{{applyInfo.accountDesc}}</span></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="wrapper ipo-information-container">
                <div class="container info-container">
                    <div class="title-container">
                        <h4 class="title">{{$t('认购明细')}}</h4>
                    </div>
                    <div class="information-container">
                        <div class="wrapper information-i">
                            <span class="lab">{{$t('认购新股')}}</span>
                            <span class="txt-box"><span class="txt">{{applyInfo.stockDesc}}</span></span>
                        </div>
                        <div class="wrapper information-i">
                            <span class="lab">{{$t('认购股数')}}</span>
                            <span class="txt-box"><span class="txt">{{$t('xx股' , {num: formatNumber(applyInfo.buyCount)})}}</span></span>
                        </div>
                        <div class="wrapper information-i">
                            <span class="lab" v-if="applyInfo.isMargin">{{$t('使用可提金额')}}</span>
                            <span class="lab" v-else>{{$t('使用现金')}}</span>
                            <span class="txt-box"><span class="txt">{{$t('xx港币' , {money: formatNumber(applyInfo.cashPart / 1000 , 2)})}}</span></span>
                        </div>
                        <div class="wrapper information-i" v-if="applyInfo.assetMargin">
                            <span class="lab">{{$t('使用富途融资')}}{{$t('（年利率xx%）' , {num: formatNumber(applyInfo.interestRate / 1000 , 2)})}}</span>
                            <span class="txt-box"><span class="txt">{{$t('xx港币' , {money: formatNumber(applyInfo.assetMargin / 1000 , 2)})}}</span></span>
                        </div>
                        <div class="wrapper information-i" v-if="applyInfo.marginPart">
                            <span class="lab">{{$t('使用银行融资')}}{{$t('（年利率xx%）' , {num: formatNumber(applyInfo.marginInterest / 1000 , 2)})}}</span>
                            <span class="txt-box"><span class="txt">{{$t('xx港币' , {money: formatNumber(applyInfo.marginPart / 1000 , 2)})}}</span></span>
                        </div>

                        <div class="wrapper information-i" v-if="applyInfo.marginPart">
                            <span class="lab">{{$t('银行融资利息（中签日当天扣除）')}}
                                <tips :tipsTxt="$t('1. 使用银行融资=认购金额-使用账户资金2. 银行融资利息=使用银行融资金额 * 计息日 * 日利率3. 预计计息日为xx天，计息时长为富途截止认购后一自然日到公布中签前一自然日' , {day: applyInfo.marginInterestDays , helpFutu5 : domain.helpFutu5})"></tips>
                            </span>
                            <span class="txt-box"><span class="txt">{{$t('xx港币', {money: formatNumber(applyInfo.expense / 1000 , 2)})}}</span></span>
                        </div>
                        <div class="wrapper information-i">
                            <span class="lab">{{$t('手续费')}}
                                <span v-if="!applyInfo.marginPart">{{$t('（先收后返）')}}</span>
                                <span v-else>{{$t('（代银行收取）')}}</span>
                                <tips :tipsTxt="$t('无论认购是否中签，均需缴纳。因参与活动获免的手续费金额请以活动详细说明为准')"></tips>
                            </span>
                            <span class="txt-box"><span class="txt">{{$t('xx港币', {money: formatNumber(applyInfo.fee / 1000 , 2)})}}</span></span>
                        </div>
                    </div>
                    <div class="wrapper ipo-tips-for-user" v-if="applyInfo.assetMargin">{{$t('使用富途融资产生的利息随融资账户月结，随借随还，不计入新股认购费用之中。最终扣费请以结单为准。')}}</div>
                </div>
            </div>
            <div class="wrapper ipo-submit-container">
                <div class="wrapper">
                    <div class="check-container">
                        <input class="ui-form-checks" type="checkbox" id="agreement" name="agreement" :value="1" v-model="isAgree" @change="switchAgree" />
                        <label class="ui-form-checkbox" for="agreement">{{$t('我已阅读并同意')}}<a :href="'//' + domain.helpFutu5 + '/faq/topic2297'" class="ui-light" target="_blank">{{$t('《富途证券新股认购声明》')}}</a></label>
                    </div>
                </div>
                <div class="wrapper">
                    <div class="submit-container actionsheet">
                        <span class="ipo-money-all">{{$t('合计：')}}<span class="ipo-all-num">{{formatNumber((applyInfo.buyAmount + applyInfo.expense + applyInfo.fee) / 1000 , 2)}}</span> {{$t('港币')}}</span>
                        <div class="sub-container">
                            <button type="submit" class="ui-btn" :class="{'ui-disabled':!isCanSubmit || isSubmit , 'ui-btn-loading':isSubmit}" :disabled="!isCanSubmit" @click="submitConfirm">{{applyInfo.tid ? $t('确认修改') : $t('立即认购')}}</button>
                            <input type="tel" pattern="[0-9]*" class="trade-pwd" @click="submitConfirm" :disabled="!isCanSubmit" v-if="!applyInfo.assetMargin && !applyInfo.marginPart">
                        </div>
                    </div>
                </div>
            </div>
        </div>
            <!-- ipo融资认购 -->
        <div class="ui-dialog-box margin-dialog-center-wrapper" v-if="this.applyInfo.assetMargin || this.applyInfo.marginPart" :class="{show:attention.isShow}">
            <div class="ui-dialog">
                <div class="ui-dialog-header">
                    <h3 class="ui-dialog-header-title">{{$t('提示')}}</h3>
                </div>
                <div class="ui-dialog-body">
                    <div class="ui-dialog-content">{{attention.message}}</div>
                </div>
                <div class="ui-dialog-footer">
                    <button class="ui-btn ui-btn-strokeGray" @click="closeAttention">{{$t('取消')}}</button>
                    <div class="ui-btn margin-dialog-wrapper">
                        {{$t('确定')}}
                        <input type="tel" pattern="[0-9]*" class="trade-pwd" @click="showPwd">
                    </div>
                </div>
                <i class="iconfont icon-close" @click="closeAttention"></i>
            </div>
        </div>
        <div class="ui-dialog-mask margin-dialog-center-wrapper" v-if="this.applyInfo.assetMargin || this.applyInfo.marginPart" :class="{show:attention.isShow}"></div>
        <notice></notice>
        <ui-dialog></ui-dialog>
        <password :is-show-pwd="password.isShowPwd" :clear-pwd="password.isClearPwd" :is-show-error="password.isShowError" @onClose="pwdClose" @onSubmit="pwdSubmit"></password>
    </div>
</template>
<script>

import {mapState} from 'vuex';
{{#xhr}}
import * as xhr from '@futuweb/tool-xhr2';
{{/xhr}}
import MD5 from 'crypto-js/md5';

import formatNumber from '../../utils/format-number';

import {checkResponse , handlerError} from '../../lib/response';

import uiDialog from '../common/dialog.vue';
import notice from './notice.vue';
import tips from '../common/tips.vue';
import password from '../common/password.vue';

const {helpFutu5 ,myFutu5 , futunn ,actFutunn} = window._params || {};

export default {
    name:'ipo-apply-information',
    data(){
        return {
            domain:{helpFutu5 ,myFutu5 , futunn ,actFutunn},
            isSubmit: false,
            isCanSubmit: false,
            isAgree: 0,
            password: {
                isShowPwd: false,
                isShowError: false,
                isClearPwd: true
            },
            attention:{
                isShow: false,
                message: ''
            }
        };
    },
    computed: mapState(['applyInfo']),
    methods:{
        formatNumber,
        switchAgree(){
            this.isAgree = +this.isAgree % 2;
            if ( this.isAgree ){
                this.isCanSubmit = true;
            }else{
                this.isCanSubmit= false;
            }
        },
        closeAttention(){
            this.attention.isShow = false;
        },
        submitConfirm(){
            if ( this.isSubmit || !this.isCanSubmit ){
                return;
            }
            //存在融资
            if ( this.applyInfo.assetMargin || this.applyInfo.marginPart ){
                let tipsText = '';
                if ( this.applyInfo.zeroAsset ){
                    if ( this.applyInfo.assetMargin && !this.applyInfo.marginPart ){
                        tipsText = this.$t('0本金认购中xx港币将使用富途融资（利率xx%）' , {
                            money: formatNumber(this.applyInfo.assetMargin / 1000 , 2) ,
                            num: formatNumber(this.applyInfo.interestRate / 1000 , 2)
                        });
                    }else if ( !this.applyInfo.assetMargin && this.applyInfo.marginPart ){
                        tipsText = this.$t('0本金认购中xx港币将使用银行融资（利率xx%）。请注意，0本金认购不支持修改，您可撤销后重新提交认购申请。' , {
                            money: formatNumber(this.applyInfo.marginPart / 1000 , 2),
                            num: formatNumber(this.applyInfo.marginInterest / 1000 , 2)
                        });
                    }else {
                        tipsText = this.$t('0本金认购中xx港币将使用富途融资（利率xx%），xx港币将使用银行融资（利率xx%）。请注意，0本金认购不支持修改，您可撤销后重新提交认购申请。' , {
                            futuMoney: formatNumber(this.applyInfo.assetMargin / 1000 , 2) ,
                            futuNum: formatNumber(this.applyInfo.interestRate / 1000 , 2),
                            money: formatNumber(this.applyInfo.marginPart / 1000 , 2),
                            num: formatNumber(this.applyInfo.marginInterest / 1000 , 2)
                        });
                    }
                }else {
                    if ( this.applyInfo.assetMargin && !this.applyInfo.marginPart ){
                        tipsText = this.$t('认购金额超过使用的可提金额，其中xx港币将使用富途融资（利率xx%）' , {
                            money: formatNumber(this.applyInfo.assetMargin / 1000 , 2) ,
                            num: formatNumber(this.applyInfo.interestRate / 1000 , 2)
                        });
                    }else if ( !this.applyInfo.assetMargin && this.applyInfo.marginPart ){
                        tipsText = this.$t('认购金额超过使用的可提金额，其中xx港币将使用银行融资（利率xx%）。请注意，银行融资认购不可撤销，若认购期间账户风险状态处于“危险”狀态，富途将保留強平权利，请注意风险。' , {
                            money: formatNumber(this.applyInfo.marginPart / 1000 , 2),
                            num: formatNumber(this.applyInfo.marginInterest / 1000 , 2)
                        });
                    }else {
                        tipsText = this.$t('认购金额超过使用的可提金额，其中xx港币将使用富途融资（利率xx%），xx港币将使用银行融资（利率xx%）。请注意，银行融资认购不可撤销，若认购期间账户风险状态处于“危险”狀态，富途将保留強平权利，请注意风险。' , {
                            futuMoney: formatNumber(this.applyInfo.assetMargin / 1000 , 2) ,
                            futuNum: formatNumber(this.applyInfo.interestRate / 1000 , 2),
                            money: formatNumber(this.applyInfo.marginPart / 1000 , 2),
                            num: formatNumber(this.applyInfo.marginInterest / 1000 , 2)
                        });
                    }
                }
                this.attention.message= tipsText;
                return this.attention.isShow = true;
            }else{
                return this.showPwd();
            }
        },
        showPwd(){
            if ( this.isSubmit ){
                return;
            }
            this.closeAttention();
            if ( this.isCanSubmit ){
                let $input = document.querySelector('input[name="txtPassword"]');
                if ( $input) {
                    $input.focus();
                }
                this.password.isShowPwd = true;
            }
        },
        pwdClose() {
            this.password.isShowPwd = false;
            this.password.isShowError = false;
        },
        async pwdSubmit(pwdVal) {
            this.pwdClose();
            return this.submitApply(pwdVal);
        },
        //提交认购
        submitApply(pwdVal){
            let data = {
                accountId: this.applyInfo.accountId,
                assetMargin: this.applyInfo.assetMargin,
                buyAmount: this.applyInfo.buyAmount,
                buyCount: this.applyInfo.buyCount,
                isMarginIpo: this.applyInfo.isMarginIpo,
                cashPart: !this.applyInfo.isMarginIpo ? this.applyInfo.buyAmount : this.applyInfo.cashPart + this.applyInfo.assetMargin,
                stockId: this.applyInfo.stockId,
                zeroAsset: this.applyInfo.zeroAsset,
                tid: this.applyInfo.tid,
                password: MD5(pwdVal).toString()
            };

            this.isSubmit = true;
            return xhr.post({url:'/api/applyStock' , dataType:'JSON' , data})
                .then(checkResponse , handlerError)
                .then(this.gotoSuccess.bind(this), this.showSubmitError.bind(this))
                .then(()=>{this.isSubmit = false;});
        },
        gotoSuccess(){
            return this.$router.replace({name:'success',path:'/success'});
        },
        showSubmitError(err){
             if ( +err.code === 500004 ){ //存在任务
                this.$store.commit('showDialog' , {
                    isCancel: false,
                    sub:this.$t('查看'),
                    message: this.$t('您已申请认购该支股票，查看任务详情'),
                    callBack: ()=> window.location.href = `/detail?stockCode=${this.applyInfo.stockCode}`
                });
            }else if ( +err.code === 800001 ){ //设置密码
                return this.$store.commit('showDialog' , {
                    sub: this.$t('去设置'),
                    message: err.message,
                    callBack: ()=> window.location.href = '//' + this.domain.myFutu5 + '/password/modify-trade-psw#setup'
                });
            }else if ( +err.code === 800004 ){ //忘记密码
                return this.password.isShowError = true;
            }
            return this.$store.commit('showDialog' , err.message);
        }
    },
    mounted(){
        if ( !this.applyInfo.accountId ){
            return this.$router.replace({name:'index',path:'/'});
        }
    },
    components: {uiDialog , notice , tips , password}
};
</script>

<style lang="scss" scoped>
$MEDIA_WIDTH:768px;
$MIN_MEDIA_WIDTH: 360px;
.container{
    width: 100%;
    margin-left: auto;
    margin-right: auto;
}
.wrapper{
    width: 100%;
    box-sizing: border-box;
}
.container::before,
.container::after,
.wrapper::before,
.wrapper::after{
    clear: both;
    content: "";
    display: table;
}
.pc-title-wrapper{
    border-bottom: 1px solid #DDE2EB;
}

.ipo-information-container{
    padding: 0 30px;
    box-sizing: border-box;
    margin-top: 16px;
}
.info-container{
    border-top: 1px solid #E9EFF8;
    padding: 28px 0;
    padding-bottom: 0;
}
.ipo-information-container .title-container{
    float: left;
    width: 300px;
}
.ipo-information-container .title-container .title{
    font-size: 16px;
    color: #284058;
    line-height: 16px;
}
.information-container{
    float: left;
    width: 466px;
}
.information-i{
    font-size: 14px;
    color: #808F9E;
    line-height: 15px;
    margin-bottom: 28px;
    position: relative;
    padding-left: 100px;
    box-sizing: border-box;
    min-height: 16px;
}
.information-i .lab{
    position: absolute;
    left: 0;
    top: 0;
}
.information-i .lab .ui-notice-text{
    color: #284058;
}
.information-i  .lab .ui-notice{
    color: #284058;
}
.information-i .txt-box{
    width: 100%;
    display: block;
}
.information-i .txt-box .txt{
    float: right;
    line-height: 1.2;
}
.ipo-submit-container{
    box-sizing: border-box;
    padding: 0 30px;
}
.ipo-submit-container .check-container,
.ipo-submit-container .submit-container{
    float: right;
}
.ipo-submit-container .check-container .ui-form-checkbox{
    margin-right: 0;
}
.ipo-submit-container .submit-container{
    margin-top: 21px;
}
.ipo-submit-container .submit-container .ipo-money-all{
    font-size: 14px;
    color: #284058;
    line-height: 24px;
    padding: 10px 14px;
    display: inline-block;
    box-sizing: border-box;
}
.ipo-submit-container .submit-container .ipo-money-all .ipo-all-num{
    color: #FF6400;
    font-size: 18px;
    vertical-align: top;
}
.sub-container{
    position: relative;
    display: inline-block;
    vertical-align: middle;
}
.sub-container .trade-pwd{
    width: 1px;
    height: 1px;
    border: none;
    background-color: transparent;
    position: absolute;
    left: 0;
    top: 0;
    color: transparent;
    z-index: 2;
    overflow: hidden;
    cursor: pointer;
}
.ipo-tips-container{
    box-sizing: border-box;
    padding: 28px 30px;
    line-height: 2em;
}
.mgtop0{
    margin-top: 0;
}
.bdtop0{
    border-top: 0;
}
.mt28{
    margin-top: 28px;
}
.limit-time.pt0{
    padding-top: 0;
}
.ipo-tips-for-user{
    text-align: right;
    margin-bottom: 28px;
    color: #808F9E;
    box-sizing: border-box;
}
.lot-tips{
    color: #B0BDC7;
}
.margin-dialog-wrapper{
    position: relative;
}
.margin-dialog-wrapper .ui-btn{
    margin: 0;
}
.margin-dialog-wrapper .trade-pwd{
    width: 100%;
    height: 42px;
    border: none;
    background-color: transparent;
    position: absolute;
    left: -1px;
    top: -1px;
    color: transparent;
    z-index: 2;
    overflow: hidden;
    cursor: pointer;
}
.margin-dialog-center-wrapper{
    display: none;
}
.margin-dialog-center-wrapper.show{
    display: block;
}
@media screen and (max-device-width: $MEDIA_WIDTH) {
    .pc-title-wrapper{
        display: none;
    }
    .ipo-title-container,
    .ipo-calendar-container{
        display: none!important;
    }
    .apply-information-container{
        background: #fff;
    }
    .apply-information-container .ui-alert{
        padding: 6px 14px;
    }
    .ipo-information-container{
        padding: 0;
        margin-top: 0;
    }
    .ipo-information-container .title-container{
        width: 100%;
        padding: 0 14px;
        box-sizing: border-box;
    }
    .information-container{
        width: 100%;
        margin-top: 14px;
        padding: 14px;
        box-sizing: border-box;
        background: #fff;
    }
    .information-i{
        margin-bottom: 18px;
    }
    .information-i .txt{
        color: #284058;
    }
    .information-i:last-child {
        margin-bottom: 0;
    }
    .info-container{
        border-top: 0;
        padding: 26px 0;
        padding-bottom: 0;
    }
    .ipo-tips-for-user{
        padding: 0 14px;
        margin-top: 8px;
        text-align: center;
    }
    .ipo-submit-container{
        padding: 14px;
        box-sizing: border-box;
    }
    .ipo-submit-container .submit-container{
        width: 100%;
        position: fixed;
        bottom: 0;
        left: 0;
        z-index: 4;
        box-sizing: border-box;
        padding: 14px;
        background: #fff;
        margin-top: 0;
        border-top: 1px solid #DDE2EB;
    }
    .ipo-submit-container .submit-container .ipo-money-all{
        width: 100%;
        text-align: center;
        padding-top: 0;
    }
    .ipo-submit-container .submit-container button{
        width: 100%;
        box-sizing: border-box;
    }
    .sub-container{
        display: block;
    }
    .sub-container .trade-pwd{
        width: 100%;
        height: 42px;
    }
    .check-container{
        width: 100%;
        text-align: center;
    }
}
@media screen and (max-device-width: $MEDIA_WIDTH){
    .en-us .information-i{
        padding-left: 0;
        .lab{
            display: block;
            width: 100%;
            position: relative;
        }
        .txt-box .txt{
            float: left;
            line-height: 1.5;
        }
    }
}
</style>
